---
title: 'Scroll Helper'
head:
    title: 'zKit: Scroll Helper (lib/controllers)'
    description: 'zKit, a collection of framework-agnostic components for modern web.'
---
{% include "../../_inc/head_open.html" %}

{% include "../../_inc/head_close.html" %}

<body layout="column top-stretch" data-ui-load="@lib/controllers/scroll_helper"
      data-ui-options="scroll_opts">









<div style="min-height: 110vh;background-color: #5ec8d5;padding-top:48px">
    <i>Scroll Helper</i>
</div>

<div>
    <!--
    "Castle Hills" graphics &copy; craftpix.net
    -->
    <img class="watch parallax" data-translate="-0.1" data-stop="0.01" src="{{root}}images/parallax/layer07_Sky.png">
    <img class="watch parallax" data-translate="-0.025" data-stop="0.01" src="{{root}}images/parallax/layer06_Rocks.png">
    <img class="watch parallax" data-translate="0.05" data-stop="0.01" src="{{root}}images/parallax/layer05_Hills.png">
    <img class="watch parallax" data-translate="0.11" data-stop="0.01" src="{{root}}images/parallax/layer04_Clouds.png">
    <img class="watch parallax" data-translate="0.15" data-stop="0.01" src="{{root}}images/parallax/layer03_Hills_Castle.png">
    <img class="watch parallax" data-translate="0.19" data-stop="0.01" src="{{root}}images/parallax/layer02_Trees_rocks.png">
    <img class="watch parallax" data-translate="0.2" data-stop="0.01" src="{{root}}images/parallax/layer01_Ground.png">
</div>

<div class="watch capguy"><h3>Hello World!</h3></div>

<div style="height: 30vh;" layout="column center-center">&nbsp;</div>

<div class="watch" data-translate="300" style="height: 70vh;" layout="column center-center">
    <h2 align="center">... todo: documentation ...</h2>
</div>

<p>...</p>

<div style="height: 70vh;" layout="column center-center">
    <i class="material-icons">arrow_upward</i>
    <h2 align="center">scroll up</h2>
</div>








<div self="size-large center">

    <p>
        To-do...
    </p>
    <div
         self="center" class="no-select scroll-box">




    </div>

</div>
<script>
    const pauseCapGuy = function(el) {
        el.css('animation-play-state', 'paused');
    };
    let capGuyAnimationTimeout;
    var scroll_opts = {
        ready: function(ctx) {
            this.on('scroll:change', function(e, data) {
                // console.log(data);
            }).watch('.watch', function(el, data) {
                el = zuix.$(el);
                if (el.hasClass('animated'))
                    return;
                if (data.event === 'enter') {
                    // TODO: ...
                } else if (data.event === 'exit') {
                    // TODO: ...
                } else if (data.event === 'scroll' || data.event === 'off-scroll') {

                    // CapGuy walking animation
                    if (zuix.$(el).hasClass('capguy')) {
                        const dy = (1-data.frame.dy);
                        const width = ctx.view().clientWidth;
                        if (dy >= -0.5 && dy <= 1.5) {
                            el.css('transform', 'translateX(' + (width*2*(dy-0.2)) + 'px)');
                            el.css('animation-play-state', 'initial');
                            if (capGuyAnimationTimeout != null) {
                                clearTimeout(capGuyAnimationTimeout);
                            }
                            capGuyAnimationTimeout = setTimeout(function(){
                                pauseCapGuy(el);
                            }, 250);
                        }
                        // ---> Fade-In enter / Fade-Out exit
                        fadeInOut(el, data);
                        return;
                    }

                    // Castle Hills parallax animation
                    if (el.attr('data-translate') != null) {
                        const dy = data.frame.dy;
                        const stop = parseFloat(el.attr('data-stop'));
                        let translate = -(document.documentElement.offsetHeight/2)+(dy*parseFloat(el.attr('data-translate'))*document.documentElement.offsetHeight);
                        if (!isNaN(stop) && dy < stop) {
                            return;
                        }
                        el.css('transform', 'translateY('+ translate + 'px)');
                        fadeInOut(el, data, 0, 0.1);
                        //el.css('opacity', 1.65-dy);
                    } else {
                        // Default "watchable" anim:
                        // ---> Fade-In enter / Fade-Out exit
                        fadeInOut(el, data);
                        /*
                        if (data.frame.dy >= -0.5 && data.frame.dy <= 1.5) {
                            el.css('transform', 'rotate(' + (360 * data.frame.dy) + 'deg)');
                        }
                        */
                    }

                }
            }).scrollStart();
        }
    };
    function fadeInOut(el, data, startOffset, endOffset) {
        if (startOffset == null)
        {
            startOffset = 0.2;
        }
        if (endOffset == null)
        {
            endOffset = 0.2;
        }
        if (data.frame.dy < startOffset) {
            el.css('opacity', data.frame.dy / startOffset);
        } else if (data.frame.dx < startOffset) {
            el.css('opacity', data.frame.dx / startOffset);
        } else if (data.frame.dy > 1-endOffset) {
            el.css('opacity', (1 - data.frame.dy) / endOffset);
        } else if (data.frame.dx > 1-endOffset) {
            el.css('opacity', (1 - data.frame.dx) / endOffset);
        } else if (parseFloat(el.css('opacity')) !== 1) {
            el.css('opacity', 1);
        }
    }
    // rotate point around [cx, cy] by given angle
    function rotate(cx, cy, x, y, angle) {
        const radians = (Math.PI / 180) * angle,
            cos = Math.cos(radians),
            sin = Math.sin(radians),
            nx = (cos * (x - cx)) + (sin * (y - cy)) + cx,
            ny = (cos * (y - cy)) - (sin * (x - cx)) + cy;
        return [nx, ny];
    }
</script>
<style>
    body {
        background: #89675b;
        color: white;
        font-size: 160%;
        line-height: 120%;
        font-family: Helvetica, sans-serif;
        overflow-x: hidden;
    }
    body i {
        font-size: 300%;
        display: table;
        margin: auto;
    }
    .watch {
        -webkit-transition: opacity 0.1s ease;
        -moz-transition: opacity 0.1s ease;
        -ms-transition: opacity 0.1s ease;
        -o-transition: opacity 0.1s ease;
        transition: opacity 0.1s ease;
    }
    .parallax {
        position: absolute;
        width: 100%;
        transform: translateY(0);
    }

    /*
    || CapGuy Animation
    || (c) Kerstin Mueller
    || https://www.codeandweb.com/blog/2014/11/05/animate-sprites-in-css-with-texturepacker
    */
    .capguy {
        position: relative;
        margin-top: 10vw;
        width: 184px; height: 325px; /* <--  size of a single frame*/
        background-image: url('{{root}}images/capguy-walk.png'); /* <-- url to spritesheet*/
        -webkit-animation: walk 1s steps(8) infinite;
        -moz-animation: walk 1s steps(8) infinite;
        -o-animation: walk 1s steps(8) infinite;
        animation: walk 1s steps(8) infinite; /* <-- animation parameters, see below*/
        z-index: 10;
        opacity: 0;
    }
    .capguy h3 {
        position: absolute;
        top: -72px;
        -webkit-text-stroke: 1px black;
        color: white;
        text-shadow:
                2px 2px 0 #000,
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
    }
    @-webkit-keyframes walk {
        from { background-position: 0; }
        to { background-position: -1472px; }  /* <-- width of spritesheet*/
    }

    @-moz-keyframes walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }

    @-o-keyframes walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }

    @keyframes walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }
</style>

<div self="size-large center" layout="columns top-stretch">

    {% include '../_inc/zkit_basic_usage.html' %}

    <h3>2. Load the scroll helper on the target element</h3>
    <p>Add the <code>data-ui-load</code> attribute to the element you want to detect gesture on</p>
<pre><code class="html">&lt;div data-ui-load="@lib/controllers/scroll_helper"
     data-ui-options="scroll_options"&gt;
    <!-- scroll container -->
&lt;/div&gt;
<script>
var scroll_options = {
    ready: function() {
        // register event callbacks
        // TODO: ....
    }
}
</script></code></pre>
    <p>
        `// TODO: ...`
    </p>
    <pre><code class="js">// TODO: ...</code></pre>

    <h2>Option attributes</h2>
    <ul>
        <li>
            <code class="option">data-ui-context</code>
            <small>optional</small><br>
            identifier name to be used to reference this component from JavaScript.
        </li>
    </ul>


    <h2>Source code</h2>
    <p>
        Source code is available in the <code>lib/controllers</code> folder of <a href="//github.com/genielabs/zkit">zKit</a> repository.
    </p>
    <div self="size-large">
        <ul class="list">
            <li><a href="//github.com/genielabs/zkit/blob/master/source/lib/controllers/scroll_helper.js">scroll_helper.js</a></li>
        </ul>
    </div>

</div>


{% include "../../_inc/body_end.html" %}

</body>
</html>