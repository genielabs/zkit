---
title: 'Scroll Helper'
head:
    title: 'zKit: Scroll Helper (lib/controllers)'
    description: 'zKit, a collection of framework-agnostic components for modern web.'
---
{% include "../../_inc/head_open.html" %}

{% include "../../_inc/head_close.html" %}

<body layout="column top-stretch" data-ui-load="@lib/controllers/scroll_helper"
      data-ui-context="scroll-helper"
      data-ui-options="scroll_opts">


<div style="min-height: 110vh;background-color: #5ec8d5;" layout="column center-center">
    <div data-ui-field="arrow-down" class="watch sh-alpha--a200" style="z-index:10">
        <i class="material-icons animated fadeInDown infinite">arrow_downward</i>
    </div>
</div>

<div layout="row top-stretch">
    <!--
    "Castle Hills" graphics &copy; craftpix.net
    -->
    <img class="watch sh-parallax" data-translate="-0.1" data-stop="0.01" src="{{root}}images/parallax/layer07_Sky.png">
    <img class="watch sh-parallax" data-translate="-0.025" data-stop="0.01" src="{{root}}images/parallax/layer06_Rocks.png">
    <img class="watch sh-parallax" data-translate="0.05" data-stop="0.01" src="{{root}}images/parallax/layer05_Hills.png">
    <img class="watch sh-parallax" data-translate="0.11" data-stop="0.01" src="{{root}}images/parallax/layer04_Clouds.png">
    <img class="watch sh-parallax" data-translate="0.15" data-stop="0.01" src="{{root}}images/parallax/layer03_Hills_Castle.png">
    <img class="watch sh-parallax" data-translate="0.19" data-stop="0.01" src="{{root}}images/parallax/layer02_Trees_rocks.png">
    <img class="watch sh-parallax" data-translate="0.2" data-stop="0.01" src="{{root}}images/parallax/layer01_Ground.png"
         data-ui-field="landscape">
</div>

<div class="watch sh--capguy"><h3>Hello World!</h3></div>

<!-- brown header (underground) -->
<div class="watch sh--follow-landscape" data-ui-field="underground" layout="column top-center">

    <h2>Scroll Helper</h2>

</div>



<script>
    const pauseCapGuy = function(el) {
        el.css('animation-play-state', 'paused');
    };
    let capGuyAnimationTimeout;
    var scroll_opts = {
        ready: function(ctx) {
            this.on('scroll:change', function(e, data) {
                // console.log(data);
                if (data.event === 'hitTop') {
                    // TODO: ...
                } else if (data.event === 'hitBottom') {
                    // TODO: ...
                }
            }).watch('.watch', function(el, data) {
                el = zuix.$(el);
                //if (el.hasClass('animated'))
                //    return;

                if (data.event === 'enter') {
                    // TODO: ...
                } else if (data.event === 'exit') {
                    // TODO: ...
                } else if (data.event === 'scroll' || data.event === 'off-scroll') {

                    // CapGuy walking animation
                    if (el.hasClass('sh--capguy')) {
                        const dy = (1-data.frame.dy);
                        const width = ctx.view().clientWidth;
                        if (dy >= -0.5 && dy <= 1.5) {
                            el.css('transform', 'translateX(' + (width*2*(dy-0.2)) + 'px)');
                            el.css('animation-play-state', 'initial');
                            if (capGuyAnimationTimeout != null) {
                                clearTimeout(capGuyAnimationTimeout);
                            }
                            capGuyAnimationTimeout = setTimeout(function(){
                                pauseCapGuy(el);
                            }, 250);
                        }
                        fadeInOut(el, data);
                    } else if (el.get().className.indexOf('sh-alpha--') > -1) {
                        // TODO:
                        if (data.frame.dy < 0.45 && data.frame.dy >= 0) {
                            el.css('opacity', data.frame.dy/0.5);
                        } else if (el.css('opacity') !== '1') {
                            el.css('opacity', '1');
                        }
                    } else if (el.hasClass('sh--follow-landscape')) {
                        const landscape = zuix.field('landscape');
                        const marginTop = parseFloat(el.css('margin-top'))-2;
                        let offsetY = landscape.position().rect.bottom-el.position().y;
                        if (!isNaN(marginTop)) {
                            offsetY+=marginTop;
                        }
                        el.css('margin-top', offsetY+'px');
                    } else if (el.hasClass('sh-parallax') != null) {
                        // Castle Hills parallax animation
                        const dy = data.frame.dy;
                        const stop = parseFloat(el.attr('data-stop'));
                        let translate = -(document.documentElement.offsetHeight / 2) + (dy * parseFloat(el.attr('data-translate')) * document.documentElement.offsetHeight);
                        if (!isNaN(stop) && dy < stop) {
                            return;
                        }
                        el.css('transform', 'translateY(' + translate + 'px)');
                        fadeInOut(el, data, 0, 0.1);
                    } else if (el.hasClass('sh-fade--in-out')) {
                        if (data.frame.dy >= -0.5 && data.frame.dy <= 1.5) {
                            el.css('transform', 'rotate(' + (360 * data.frame.dy) + 'deg)');
                        }
                    } else {
                        // Default "watchable" animation:
                        //     ---> Fade-In enter / Fade-Out exit
                        fadeInOut(el, data);
                    }

                }
            }).scrollStart().scrollEnd().scrollStart();
        }
    };
    zuix.field('arrow-down').on('click', function () {
        zuix.context('scroll-helper').scrollTo(500, 2000);
    });
    function fadeInOut(el, data, startOffset, endOffset) {
        if (startOffset == null) {
            startOffset = 0.2;
        }
        if (endOffset == null) {
            endOffset = 0.2;
        }
        if (data.frame.dy < startOffset) {
            el.css('opacity', data.frame.dy / startOffset);
        } else if (data.frame.dx < startOffset) {
            el.css('opacity', data.frame.dx / startOffset);
        } else if (data.frame.dy > 1-endOffset) {
            el.css('opacity', (1 - data.frame.dy) / endOffset);
        } else if (data.frame.dx > 1-endOffset) {
            el.css('opacity', (1 - data.frame.dx) / endOffset);
        } else if (parseFloat(el.css('opacity')) !== 1) {
            el.css('opacity', 1);
        }
    }
    // rotate point around [cx, cy] by given angle
    function rotate(cx, cy, x, y, angle) {
        const radians = (Math.PI / 180) * angle,
            cos = Math.cos(radians),
            sin = Math.sin(radians),
            nx = (cos * (x - cx)) + (sin * (y - cy)) + cx,
            ny = (cos * (y - cy)) - (sin * (x - cx)) + cy;
        return [nx, ny];
    }
</script>
<style>
    body {
        color: white;
        font-size: 160%;
        line-height: 120%;
        font-family: Helvetica, sans-serif;
        overflow-x: hidden;
    }
    body i {
        font-size: 300%;
        display: table;
        margin: auto;
    }
    .watch {
        -webkit-transition: opacity 0.1s ease;
        -moz-transition: opacity 0.1s ease;
        -ms-transition: opacity 0.1s ease;
        -o-transition: opacity 0.1s ease;
        transition: opacity 0.1s ease;
    }
    .sh-parallax {
        position: absolute;
        width: 100%;
        transform: translateY(0);
    }
    [data-ui-field="underground"] {
        background: #89675b;
        width: 100%;
        min-height: 75vh;
    }
    [data-ui-field="arrow-down"] {
        transition: 0.1s ease-in-out;
    }
    [data-ui-field="arrow-down"] i {
        font-size:400% !important;
        z-index:10;
    }

    /*
    || CapGuy Animation
    || (c) Kerstin Mueller
    || https://www.codeandweb.com/blog/2014/11/05/animate-sprites-in-css-with-texturepacker
    */
    .sh--capguy {
        position: relative;
        margin-top: 10vw;
        width: 184px; height: 325px; /* <--  size of a single frame*/
        background-image: url('{{root}}images/capguy-walk.png'); /* <-- url to spritesheet*/
        -webkit-animation: sh--capguy-walk 1s steps(8) infinite;
        -moz-animation: sh--capguy-walk 1s steps(8) infinite;
        -o-animation: sh--capguy-walk 1s steps(8) infinite;
        animation: sh--capguy-walk 1s steps(8) infinite; /* <-- animation parameters, see below*/
        z-index: 10;
        opacity: 0;
    }
    .sh--capguy h3 {
        position: absolute;
        top: -72px;
        -webkit-text-stroke: 1px black;
        color: white;
        text-shadow:
                2px 2px 0 #000,
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
    }
    @-webkit-keyframes sh--capguy-walk {
        from { background-position: 0; }
        to { background-position: -1472px; }  /* <-- width of spritesheet*/
    }

    @-moz-keyframes sh--capguy-walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }

    @-o-keyframes sh--capguy-walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }

    @keyframes sh--capguy-walk {
        from { background-position: 0; }
        to { background-position: -1472px; } /* <-- width of spritesheet*/
    }
</style>

{% include "../../_inc/body_end.html" %}

</body>
</html>